---
title: '.large[The use of colour in graphics]'
subtitle: ".large[A journey through the body & mind to the screen]"  
author: "<span style = 'font-size: 90%;'>Nicholas Tierney, Monash University</span>"
date: "<div class='medium'>Monash Data Fluency, June 26 <br><br> `r # icon::fontawesome(name = 'link', 'solid')` **bit.ly/njt-monash-colour** <br><br> `r # icon::fontawesome$brands$twitter` **nj_tierney**</div>"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [njtheme.css, extra.css, animate.css]
    nature:
      ratio: "16:9"
      titleSlideClass: ["left", "middle", "inverse"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: "%current%"
---

layout: true
<div class="my-footer"><span>bit.ly/njt-monash-colour • @nj_tierney</span></div> 


```{r setup, include=FALSE}
# options(htmltools.dir.version = FALSE, width = 120)
# NOTE TO SELF: The CSS styles were created in `create-njt-theme.R`
knitr::opts_chunk$set(
  fig.path = "figures/",
  cache.path = "cache/",
  fig.align = "center",
  fig.width = 13,
  fig.height = 6,
  fig.retina = 3,
  fig.show = "hold",
  external = TRUE,
  # dev = "svglite",
  # dev.args = list(bg = "transparent"),
  message = FALSE,
  warning = FALSE,
  cache = TRUE,
  echo = FALSE,
  autodep = TRUE
)
```

```{r icons}
fa_twitter <- icon::fontawesome$brands$twitter
fa_github <- icon::fontawesome$brands$github
fa_link <- icon::fontawesome$solid$link
fa_plane <- icon::fontawesome$solid$`paper-plane`
fa_box_open <- icon::fontawesome$solid$`box-open`
```


```{r library, include = FALSE}
library(tidyverse)
library(gganimate)
library(knitr)
library(drake)
library(colorspace)
library(magick)
library(ggspectra)
library(scales)
library(drake)
library(photobiology)
library(photobiologyWavebands)
```

```{r fun-tidy-photowave}
read_tidy_photowave <- function(path){
  readr::read_csv(file = path,
                  col_names = c("wavelength_nm",
                                "cone_s",
                                "cone_m",
                                "cone_l")) %>% 
  tidyr::pivot_longer(cols = cone_s:cone_l,
                      names_to = "type",
                      values_to = "response")
}

# data provided from http://cvrl.ucl.ac.uk/cones.htm
# 10-deg fundamentals based on the Stiles & Burch 10-deg CMFs
  # units: energy (linear)
  # stepsize: 0.1 nm
  # Format: csv

cone_response <- read_tidy_photowave(
  here::here("slides/data/linss2_10e_fine.csv")
)
```

```{r funs-p-img}
p_img <- function(obj, nam) {
  image(1:length(obj), 1, as.matrix(1:length(obj)), col=obj, 
        main = nam, ylab = "", xaxt = "n", yaxt = "n",  bty = "n")
}
```


```{r helpers, include=FALSE}
mp4_vid <- function(src){
  HTML(
    paste0(
      '<video autoplay>
        <source src="', src, '" type="video/mp4">
      </video>'
    )
  )
}

fig.fullsize <- c(fig.height = 3.5, fig.width = 8, out.width = "150%"
)

as_table <- function(...) knitr::kable(..., format='html', digits = 3)

theme_set(
  theme_grey(base_size = 16) +
  theme(
    legend.position = "bottom",
    plot.background = element_rect(fill = "transparent"),
    legend.background = element_rect(fill = "transparent")
  )
)

# **ni**ck's **pa**lette
nipa <- list(red = "#c03018",
             orange = "#f0a800",
             green = "#609048",
             purple = "#484878",
             light_purple = "#A3A3BB",
             light_green = "#AFC7A3",
             light_orange = "#F7D37F",
             light_red = "#DF978B",
             pale_purple = "#ECECF1",
             pale_green = "#D7E3D1",
             pale_orange = "#FBE9BF",
             pale_red = "#EFCBC4")

```

```{r funs-cone-receptor}
gg_colour_spectra <- function(cone_response){
  ggplot(cone_response,
       aes(x = wavelength_nm,
           y = response,
           group = type)) + 
  wl_guide(chroma.type = "CMF") +
  scale_x_continuous(limits = c(390, 710), 
                     expand = c(0, 0),
                     breaks = scales::breaks_width(25)) +
    labs(x = "Wavelength (nm)",
         y = "Normalised cone response (linear energy)")
}

gg_cone_receptor <- function(cone_response){
gg_colour_spectra(cone_response) +
  geom_line(colour = "white", size = 1)
}
```

---

# Your turn: What makes this graphic good, and bad?

```{r show-bom}
include_graphics(here::here("slides/imgs/bom-heat-map.png"))
```

---

# BoM `r emo::ji("sad")`


```{r load-maps, cache = FALSE}
drake::loadd(map_high_temp)
drake::loadd(map_high_temp_bom)
drake::loadd(map_high_temp_viridis)
```

```{r map-bom, cache = FALSE}
map_high_temp_bom
```

---

# Viridis `r emo::ji("happy")`

```{r map-viridis, cache = FALSE}
map_high_temp_viridis
```

---

# Default ggplot `r emo::ji("happy")`

```{r map-default-ggplot, cache = FALSE}
map_high_temp + 
  labs(fill = NULL) +
  guides(guide = guide_legend(reverse = TRUE))
```

---

# Jet?

```{r map-jet, cache = FALSE}
map_high_temp +
  scale_fill_manual(
      values = pals::jet(n = 19),
      name = "",
      guide = guide_legend(reverse = TRUE)
        )
```

???

Sometimes the conversation ends there, and you provide them a few graphics that look better. Like this.

---
# How do we describe what is better/worse about them?

```{r both-maps, out.width = "20%", fig.show='hold'}
map_high_temp_bom
map_high_temp_viridis
```

---

# But why is one better?

.left-code[
```{r show-bom-again-again}
include_graphics(here::here("slides/imgs/bom-heat-map.png"))
```
]

.right-plot[
- Need a vocabulary to describe **why** this is wrong
- Not just: "It's not colourblind safe", "The colours are wrong"
]

???

I guess the other parts of my motivation for this talk come from seeing a lot of people using bad/sub optimal colourscales. 

There is great tooling in R to do the following:

---

# Two terms to unpack

- Colourblindness
- Perceptually uniform

--

- ... But to do that we need to unpack a few more things

---
# Goals of this talk

- What is colour?
- How do we see colour?
- What is colourblindness?
- What is a vocabulary around colour?
- How do I use colour in my plot?
- How do I assess colour?
- How do I create new colour palettes?

???

This made sense to me, I know what colourblindness is, and I know what perceptually uniform means.

But I also have an honours degree in Psychological Science. My honours project studied the human visual system, in an area called psychophysics. I didn’t study colour, but we did need to learn about the visual system in neuropsychology.


# What is colour?

--

Disclaimer: This is a _brief_ introduction into a **complex** topic

This section is inspired by [Calder Hansen's ](https://www.youtube.com/channel/UC7zwxzcgdrjnFkRrLnfN_CA) [The Science of Color Perception](https://www.youtube.com/watch?v=poL7nDmqjmk))


---
# Colour: Waves of light, perceived.


Just as there are soundwaves that you can hear `r emo::ji("sound")` `r emo::ji("ear")`

There are lightwaves that we see `r emo::ji("light")` `r emo::ji("eyes")`

???

This combines physics, biology, and a bit of philosophy. 

---
# Physics of Colour

These lightwaves come in different shapes - different wavelengths:

**image**

---
# The visible spectrum

```{r show-spectra}
gg_colour_spectra(cone_response)
```


??

- At this end we have the longest wavelengths
- At this end we have the shortest wavelengths

---
# Physics of Colour (More than we can see)

```{r show-em, out.width = "80%"}
include_graphics(here::here("slides/imgs/em-spectrum.svg"))
```

> From https://commons.wikimedia.org/wiki/File:EM_spectrum.svg 

<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.

???

- Note that this is just a tiny slice of the light spectrum
- We just happen to be able to see this range of colours
- But How?

---
# Physics of Colour

(graphic from ipad)


???
- Lightwaves enter our eyes, and we have the perception of colour.
  - Shorter wavelengths = "purple" / "blue
  - longer wavelengths = "red"
  
- As light enters the eye, it hits cells that are sensitive to light. 
- These cells are called rods and cones. 
- The cones are the bits that allow us to see colour

---
# Biology of colour: cones

- If we get only one type of colour entering in the eye, we get one colour.
- This is because of these three cones:

```{r show-cones, out.width = "50%"}
include_graphics(here::here("slides/imgs/cone-family-trim.png"))
```
  
- Colours are brighter when there is more of the light
- most colours are a combination of multiple wave lengths

  
---
# Biology of colour: cones

- We can actually plot how sensitive each of these cones are like so:

```{r cone-sensitivity}
cone_response %>% gg_cone_receptor()
```


[from https://en.wikipedia.org/wiki/Cone_cell]

> Normalized responsivity spectra of human cone cells, S, M, and L types


Image inspired by [figure of responsivity of human eye from Wikipedia](https://en.wikipedia.org/wiki/File:Cone-fundamentals-with-srgb-spectrum.svg), data extracted from [Colour & Vision Research laboratory at UCL's](http://cvrl.ucl.ac.uk) section on [cones](http://cvrl.ucl.ac.uk/cones.htm).



---
# How do we see colour? Red?

So what happens when we are exposed to a lot of these longer wavelengths of "red" light?

- Long cones react
- Medium cones not so much
- S cones not at all

That information is then taken in to your brain and then you have the sensation of "red".

---
# But I don't just see red and green and blue?

- Colour is made up of the _combination_ of light entering our eye.
- Red could be some of ..., and some of ...
- Orange could be
- White could be all colours, or it could just be 

There are actually many different combinations of light waves that can get us to see different colours.

This means that colour is not just a single light waves, or a combination of many, but it is our perception of light

---
# Colourblindness

- What happens if someone doesn't have some of these cones?
- Or one of the cones isn't as responsive?
- This is what we call **colourblindness** and **colourweakness**

- Depending on which cones are missing, this means some sets of colours are indistinguishable from one another. 

- It affects up to 10% of males of European descent, and 1 in 200 women (REF).

---
# Full colour vision

```{r full-colour}
gg_cone_receptor(cone_response)
```


---
# No S cone = Protonopia (Less "red")

```{r show-colour-response-no-s}
cone_response %>% filter(type != "cone_s") %>%  gg_cone_receptor()
# Show the density shrinking? Or perhap use magick to fade it out
# or using gganimate with transition_states() exit_fade() or exit_shrink()?
```

---
# No M cone = Deutanopia (Less "green")

```{r show-colour-response-no-m}
cone_response %>% filter(type != "cone_m") %>%  gg_cone_receptor()
```

---
# No L cone = Tritanopia (Less "Blue")

```{r show-colour-response-no-l}
cone_response %>% filter(type != "cone_l") %>%  gg_cone_receptor()
```

---
# Without those cones, some colours look the same


---
# Colourblindness, why does it matter? 

This is why traffic lights have position markings, instead of just the same position changing colour.

```{r traffic-cones}
traffic <- image_read_svg(
  here::here("slides/imgs/traffic-light.svg")
)

# red_light <- traffic %>% image_crop("275x230 + 0 + 29")
# amber_light <- traffic %>% image_crop("275x230 + 0 + 260")
# green_light <- traffic %>% image_crop("275x230 + 0 + 491")

# colorspace::cvd_emulator(here::here("content/post/drafts/2020-06-10-what-is-colourblindness/imgs/traffic-light.jpeg"))

traffic_deutan <- image_read(
  here::here("slides/imgs/deutan_traffic-light.jpeg")
)
traffic_protan <- image_read(
  here::here("slides/imgs/protan_traffic-light.jpeg")
)
traffic_tritan <- image_read(
  here::here("slides/imgs/tritan_traffic-light.jpeg")
)

# traffic_deutan %>% image_annotate(text = "Deutan", 
#                                   color = "white",
#                                   gravity = "south",
#                                   size = 20)
```

---
# Normal Traffic Light

```{r traffic-normal}
traffic
```

---
# Traffic Light (Protan)

```{r traffic-protan}
traffic_protan
```

---
# Traffic Light (Deutan)

```{r traffic-deutan}
traffic_deutan
```

---
# Traffic Light (Tritan)

```{r traffic-tritan}
traffic_tritan
```


---
# All the traffic lights

```{r traffic-cones-all}
image_append(c(traffic,
               traffic_protan,
               traffic_deutan,
               traffic_tritan))

```

???

_gif of good traffic light for different vision_

vs

_gif of bad traffic light with different vision_


---
# Colourblindness, my point is:

> Some colours cannot be distinguished by those with colourblindness, so we need to be careful how we present colour, and what colours we present.

---
# How to test how well your plot stands up to colourblindness?

---
# Colourblindness: testing our colours

- 

There are many colourblindness simulators, but we can use some in R. They take in an image as a JPG/PNG. So now, let's explore what this original image from BoM looks like.

To do so, we can use the `cvd_emulator` function from `colorspace`:

```r
cvd_emulator("imgs/bom-heat-map.png")
```

---

# Original image

```{r og-bom, out.width = "60%"}
include_graphics(here::here("slides/imgs/bom-heat-map.png"))
```

---

# Protan image (No Red Cone)

```{r protan-bom, out.width = "60%"}
include_graphics(here::here("slides/imgs/protan_bom-heat-map.png"))
```

---

# Deutan image (No Green Cone)

```{r deutan-bom, out.width = "60%"}
include_graphics(here::here("slides/imgs/deutan_bom-heat-map.png"))
```

---

# Tritan image (No Blue Cone)

```{r tritan-bom, out.width = "60%"}
include_graphics(here::here("slides/imgs/tritan_bom-heat-map.png"))
```

---

# Greyscale image

```{r desat-bom, out.width = "60%"}
include_graphics(here::here("slides/imgs/desaturate_bom-heat-map.png"))
```

- What is a vocabulary around colour?
- How do I assess colour?
- How do I create new colour palettes?

---
# Colour in graphics

- Something about that grayscale plot was interesting
- There is a wide vocab that we can use to discuss colour. 
- We can actually describe what any colour is, using the different values of red, green, and blue. 
- Example, example
- But this is hard for us to really imagine and predict
- For example - determining that the colour, 

---
# Hue, Chroma, Luminance: Another way to describe colour

```{r show-hcl, out.width = "80%"}
swatchplot(
  "Hue"       = sequential_hcl(5, h = c(0, 300), c = c(60, 60), l = 65),
  "Chroma"    = sequential_hcl(5, h = 0, c = c(100, 0), l = 65, rev = TRUE, power = 1),
  "Luminance" = sequential_hcl(5, h = 260, c = c(25, 25), l = c(25, 90), rev = TRUE, power = 1),
  off = 0
)
```


???

These go by other names, and are just one of a set of many different colour representations (HSV, CIELAB, … ), and the literature on colourspace is wide and vast. These allow us to explore and explain colour in a way that makes sense to human.

These are human readable ways to describe colour, but ultimately get expressed into terms of RGB.

--- 
# Can we describe our previous maps in terms of hue, chroma, luminance?


---
# Using `colorspace` to explore colour palettes

- We can explore some colour palettes using HCL, with the `specplot` function from `colorspace`. 

???

I have the nice colours used in the Australian heat data here, which we can view with `swatchplot` from `colorspace`, or `show_cols` from `scales`


---
# Using HCL to explore palettes: viridis

```{r show-specplot}
specplot(endtherainbow::bom_viridis_palette)
```

---
# Using HCL to explore palettes: BoM

```{r show-specplot-bom}
specplot(endtherainbow::bom_standard_palette)
```

---
# Using HCL to explore palettes: Rainbow

```{r show-specplot-rainbow}
specplot(rainbow(n = 20))
```

---
# Using HCL to explore palettes: Base Terrain

```{r show-specplot-terrain, echo = TRUE, out.width = "20%", fig.show='hold'}
terrain.colors(n = 20) %>% specplot()
```

---
# Using HCL to explore palettes: Better Terrain

```{r show-specplot-better-terrain, echo = TRUE, out.width = "20%", fig.show='hold'}
scico::scico(n = 20, palette = "oleron") %>% specplot()
```

---
# Using HCL to explore palettes: Jet

```{r show-specplot-jet, echo = TRUE}
pals::jet(n = 20) %>% specplot()
```

---
# Other ways to assess colorblindness

- CVD simulators: `protan`, `deutan`, `tritan`

```{r}
terrain.colors(n = 20) %>% protan() %>% specplot()
terrain.colors(n = 20) %>% deutan() %>% specplot()
terrain.colors(n = 20) %>% tritan() %>% specplot()
scico::scico(n = 20, palette = "oleron") %>% protan() %>% specplot()
scico::scico(n = 20, palette = "oleron") %>% deutan() %>% specplot()
scico::scico(n = 20, palette = "oleron") %>% tritan() %>% specplot()
pals::jet(n = 20) %>% protan() %>% specplot()
pals::jet(n = 20) %>% deutan() %>% specplot()
pals::jet(n = 20) %>% tritan() %>% specplot()
```

---
# How to evaluate existing colour palettes or images

Colourspace

Choose_color / hcl_color_picker
Cvd_emulator
Use hclwizard

Circle back to the BoM plot
Describe how we could improve it

Create better ones that are accessible to all

This is going to be biased towards R

---
# Types of palettes

- Qualitative
- Sequential
- Diverging

---
# Qualitative - in specplot

```{r qual-specplot}
specplot(qualitative_hcl(n = 6))
```


---
# Sequential: specplot

```{r seq-specplot}
specplot(sequential_hcl(n = 7))
```

---
# Multi Sequential: specplot

```{r seq-multi-specplot}
specplot(sequential_hcl(h1 = 0, h2 = 300, n = 7))
```

---
# Diverging: specplot

```{r div-specplot}
specplot(diverging_hcl(n = 7))
```

---

# Some recommended colour palettes

- colorspace
- viridis
- scico

---

# Viewing your colour palette

- colorspace::demoplot

---

```{r specplot-bom-viridis}
specplot(endtherainbow::bom_viridis_palette)
```

---

```{r specplot-bom-standard}
specplot(endtherainbow::bom_standard_palette)
```

---
# Perceiving colourblindness with cvd_emulator

---
# Creating your own colour palette with `colorspace`

1. Decide what type of palette you want (Sequential, Diverging, etc)
2. Decide what colours you want to go through

---
# Example: HCL

1. Decide what type of palette you want (Sequential, Diverging, etc)
2. Decide what colours you want to go through


---
# Example: HCL - what is Hue?

```{r}
# Maybe turn this into a pie chart...
df <- data.frame(
  y = 1,
  hue = 0:360)

ggplot(df, aes(x = hue,
               y = y,
               fill = as.factor(hue),
               colour = as.factor(hue))) + 
  geom_col() +
  scale_fill_hue() +
  theme(legend.position = "none") +
  # xlim(c(0, 1))
  coord_polar()

```

---
# Use `sequential_hcl` and provide one hue

```{r}
sequential_hcl(n = 20,
               h = 300) %>% 
  specplot()
```

---
# Use `sequential_hcl` and provide two hues

```{r}
sequential_hcl(n = 20,
               h = c(360, 120),
               c = c(25, 50, 25),
               l = c(25, 50, 25)) %>% 
  specplot()
```


---

# Take homes

- Colour choice matters
- See colorspace / viridis / scico
- Assess colours with `colorspace::specplot()`
- Assess colourblindness with `colorspace::cvd_emulator()`
- Evaluate your own colour palettes at `hclwizard.com`
- Choose colour palettes with 
  - `colorspace::choose_palette()`
  - `colorspace::choose_color()`
  - `colorspace::hcl_color_picker()`

---

# Thanks

.large.pull-left[
- Adam Sparks
- Nonie Finlayson
- Philip Groce
- Stuart Lee
]

.large.pull-right[
- Di Cook
- Miles McBain
- Achim Zieleis
- So many great people
]

---

# Resources

.large[
- [Colorspace by Zeilies et al]()
- [Colorspace talk by Achim Zeilies]()
- [How your colorblind and colorweak readers see your colors](https://blog.datawrapper.de/colorblindness-part1/) by [Lisa Charlotte Rose](Part 1 of 3)
- [What to consider when visualizing data for colorblind readers](https://blog.datawrapper.de/colorblindness-part2/) by [Lisa Charlotte Rose](Part 2 of 3)
[The Science of Color Perception](https://www.youtube.com/watch?v=poL7nDmqjmk) by [Calder Hanson](https://www.youtube.com/channel/UC7zwxzcgdrjnFkRrLnfN_CA)
]

---

# Colophon

.large[
- Slides made using [xaringan](https://github.com/yihui/xaringan)
- Extended with [xaringanthemer](https://github.com/gadenbuie/xaringanthemer)
- Colours taken + modified from [lorikeet theme from ochRe](https://github.com/ropenscilabs/ochRe)
- Header font is **Josefin Sans**
- Body text font is **Montserrat**
- Code font is **Fira Mono**
- template available: [njtierney/njt-talks](github.com/njtierney/njt-talks)
]

---

# Learning more

.large[
`r fa_box_open` [colorspace by Zeileis et al.](http://colorspace.r-forge.r-project.org/index.html)

`r fa_link` [talk link]()

`r fa_twitter` nj_tierney

`r fa_github` njtierney

`r fa_plane` nicholas.tierney@gmail.com

]



---

.vhuge[
**End.**
]

---
# Extra content

---
# Stepping back: How do we use colour in a data analysis

We use colour so that we can understand some other dimension of the data.

For example.

What are the components of the graphic?

X axis...y axis...colour, how these map onto a graphic

---
# Fullscreen gif of colours that change, but are (pretty much) exactly the same colour for people with colourblindness.

---
Neurobiology

On the other end of this, there are tetrachromats, who have an additional red cone, and can perceive colours that others cannot. Pretty cool,

And if you want to get really into it, animals around the world have many numbers of cones.

Birds typically have 4 cones
Dogs have .. cones

Rather amazingly, the mantis shrimp has 16 cones.

Highly recommend [this episode of Radiolab]() that unpacks that topic

---


```{r}

```

http://hclwizard.org/

My own questions

- What do the hex values actually mean?
- What are the ranges of the hue values (0-360 or -360,360)
- What are the ranges of the chroma values (0-100)
- What are the ranges of the luminance values (0-100)
  - Note that the chroma/luminance values can change
  - the possible combinations of chroma and luminance in HCL space depend on hue


Let's say you have two colours, red and green. Here is what non-colourblind people see:

```{r plot-red-green, fig.height = 3}
red_green <- prismatic::colour(c("red", "darkgreen"))
p_img(red_green, "Red & Green")
```

---
# Colourblindness, why does it matter? 

But if you have colourblindness, you might see something like the following:

```{r plot-many-red-green, fig.height = 3, fig.width = 2}
red_green_dt <- colorspace::deutan(red_green)
red_green_pt <- colorspace::protan(red_green)
red_green_tt <- colorspace::tritan(red_green)

p_img(red_green_pt, "Red & Green for Protan")
p_img(red_green_dt, "Red & Green for Deutan")
p_img(red_green_tt, "Red & Green for Tritan")
```


---

```{r scales-plot-many-red-green, fig.height = 3, fig.width = 2}
show_col(red_green, labels = FALSE)
show_col(red_green_pt, labels = FALSE)
show_col(red_green_dt, labels = FALSE)
show_col(red_green_tt, labels = FALSE)
```


---

Downsides to RGB:

perceptually uniform (a unit step within RGB does
not produce a constant perceptual change in color)

> I should also say straight off the bat, thanks to Achim Zeileis and the co-authors of the Colorspace package - link - Achim’s talk - link - helped provide a lot of thinking points for this subject.

---
# Example, RGB vs HCL

```{r}
specplot(qualitative_hcl(n = 6),
         rgb = TRUE)
```
